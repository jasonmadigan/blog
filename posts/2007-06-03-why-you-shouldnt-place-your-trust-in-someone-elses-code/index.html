<!doctype html><html lang=en-us><head><title>Why you shouldn't place your trust in someone else's code // Jason Madigan</title>
<link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.140.2"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jason Madigan"><meta name=description content><link rel=stylesheet href=/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Why you shouldn't place your trust in someone else's code"><meta name=twitter:description content="About two years ago I used to regularly play World of Warcraft; something which I’m not particularly proud of. While doing so I managed and maintained a small community site for our guild. Our guild was comprised of several members of the somethingawful forums and, as such, our humour tended to be a little more odd than most. If you’ve laughed at something morally bankrupt on the internet, chances are it originated on the forums there. After a few months, we formed a chilled out raidgroup and started regularly raiding dungeons. This meant we’d need some system for distributing loot amongst ourselves lest we find ourselves in a position where people’s poopsockery go unrewarded. We settled on a system called DKP, or Dragon Kill Points. Basically when you attend raids you bid on loot, and your bid is divided amongst all those present such that people who attend more get more loot. To implement this, we settled with a popular PHP script called EQDKP to manage our points."><meta property="og:url" content="/posts/2007-06-03-why-you-shouldnt-place-your-trust-in-someone-elses-code/"><meta property="og:site_name" content="Jason Madigan"><meta property="og:title" content="Why you shouldn't place your trust in someone else's code"><meta property="og:description" content="About two years ago I used to regularly play World of Warcraft; something which I’m not particularly proud of. While doing so I managed and maintained a small community site for our guild. Our guild was comprised of several members of the somethingawful forums and, as such, our humour tended to be a little more odd than most. If you’ve laughed at something morally bankrupt on the internet, chances are it originated on the forums there. After a few months, we formed a chilled out raidgroup and started regularly raiding dungeons. This meant we’d need some system for distributing loot amongst ourselves lest we find ourselves in a position where people’s poopsockery go unrewarded. We settled on a system called DKP, or Dragon Kill Points. Basically when you attend raids you bid on loot, and your bid is divided amongst all those present such that people who attend more get more loot. To implement this, we settled with a popular PHP script called EQDKP to manage our points."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2007-06-03T21:00:00+00:00"><meta property="article:modified_time" content="2007-06-03T21:00:00+00:00"></head><body><header class=app-header><a href=/><img class=app-header-avatar src=/0.jpg alt="Jason Madigan"></a>
<span class=app-header-title>Jason Madigan</span><nav class=app-header-menu><a class=app-header-menu-item href=/about/>About</a></nav><p>He's just zis guy, ya know?</p><div class=app-header-social><a href=https://github.com/jasonmadigan target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
</a><a href=https://twitter.com/jasonmadigan target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Why you shouldn't place your trust in someone else's code</h1><div class=post-meta><div><svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Jun 3, 2007</div><div><svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 min read</div></div></header><div class=post-content><p>About two years ago I used to regularly play World of Warcraft;
something which I&rsquo;m not particularly proud of. While doing so I managed
and maintained a small community site for our guild. Our guild was
comprised of several members of the somethingawful forums and, as such,
our humour tended to be a little more odd than most. If you&rsquo;ve laughed
at something morally bankrupt on the internet, chances are it originated
on the forums there. After a few months, we formed a chilled out
raidgroup and started regularly raiding dungeons. This meant we&rsquo;d need
some system for distributing loot amongst ourselves lest we find
ourselves in a position where people&rsquo;s
<a href=http://en.wikipedia.org/wiki/Poopsocking>poopsockery</a> go unrewarded.
We settled on a system called DKP, or Dragon Kill Points. Basically when
you attend raids you bid on loot, and your bid is divided amongst all
those present such that people who attend more get more loot. To
implement this, we settled with a popular PHP script called
<a href=http://www.eqdkp.com>EQDKP</a> to manage our points.</p><p>Anyway, I installed EQDKP and because I was busy at the time and because
I&rsquo;m pretty lazy, I never really got a chance to read around the
applications code. Pretty much everyone else is using this so I&rsquo;m sure
it&rsquo;s reasonably secure, right?</p><p>I quit playing World of Warcraft last August after realising that game
was a complete sack of shit and spending so much time playing it was
completely stupid. I continued to maintain the guild&rsquo;s website in the
meantime before eventually passing it on to a fellow web developer
guild-member a week ago. While rsync&rsquo;ing, out of boredom, I decided to
peruse EQDKP&rsquo;s source. I started to become very nervous. This code had
been running for almost a year on my box?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// First things first - a small amount of security
</span></span></span><span style=display:flex><span><span style=color:#75715e>// This script is *so* hackable as to not be funny
</span></span></span><span style=display:flex><span><span style=color:#75715e>// The possible benefit (IMO) outweighs the possible security
</span></span></span><span style=display:flex><span><span style=color:#75715e>// issue with referrer hacking tho
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Check that the visitor&#39;s referrer was a page within your own site.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Copyright 2001 Tim Green
</span></span></span><span style=display:flex><span><span style=color:#75715e>// http://www.dwfaq.com/snippets/snippet_details.asp?SnipID=51
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>$tg__ServerName<span style=color:#f92672>=</span><span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#34;.&#34;</span>,<span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#34;SERVER_NAME&#34;</span>));
</span></span><span style=display:flex><span>$tg__server<span style=color:#f92672>=</span>$tg__ServerName[<span style=color:#a6e22e>count</span>($tg__ServerName)<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>]<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;.&#34;</span><span style=color:#f92672>.</span>$tg__ServerName[<span style=color:#a6e22e>count</span>($tg__ServerName)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>$tg__Referred <span style=color:#f92672>=</span> <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#34;HTTP_REFERER&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Get host name from URL
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/^(http://)?([^/]+)/i&#34;</span>, $tg__Referred, $tg__RefHost);
</span></span><span style=display:flex><span>$tg__Host <span style=color:#f92672>=</span> $tg__RefHost[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/[^./]+.[^./]+$/&#34;</span>, $tg__Host, $tg__RefHost);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($tg__RefHost[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>!=</span> $tg__server) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Change the location to your desired page
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Location: ./../../viewnews.php&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Now start the &#34;stuff&#34; 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><blockquote><p>This script is <strong>so</strong> hackable as to not be funny. The possible
benefit (IMO) outweighs the possible security issue with referrer
hacking tho.</p></blockquote><p>Oh dear.</p><p>So, to access EQDKP&rsquo;s database backup functionality within it&rsquo;s admin
panel all we have to do is point a browser to:</p><p><code>http://myguild.com/eqdkp/admin/backup</code></p><p>And spoof HTTP request referral to read:</p><p><code>http://myguild.com/eqdkp/admin/</code></p><p>That&rsquo;s it, you&rsquo;ve now got full access to EQDKP&rsquo;s database, we&rsquo;re even
presented with a nice interface to dump the database&rsquo;s contents.</p><p>As if this isn&rsquo;t stupid enough, EQDKP doesn&rsquo;t salt its user&rsquo;s
passwords prior to hashing them. With this in mind we can fire up
whichever web version of RainbowCrack is currently not serving up 404&rsquo;s
and we have the user&rsquo;s plaintext password. We could also dump the
database and change the administrators password to one of our choosing
by simply replacing the hash (since it&rsquo;s not salted). People being
people, we tend to use the same password for pretty much everything. Our
email, PayPal, banking details etc., all compromised by one shitty
script. Pretty scary, eh?</p></div><div class=post-footer></div></article></main></body></html>
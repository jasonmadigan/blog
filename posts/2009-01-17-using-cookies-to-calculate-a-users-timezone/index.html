<!doctype html><html lang=en-us><head><title>Using cookies to calculate a user's timezone // Jason Madigan</title>
<link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.140.2"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Jason Madigan"><meta name=description content><link rel=stylesheet href=/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Using cookies to calculate a user's timezone"><meta name=twitter:description content="A few days ago I discovered a quick & easy way few to use cookies to help your Rails app get a user’s timezone, without prompting. It’s pretty easy to implement:
First up: set a cookie, any cookie:
var date = new Date(); // returns offset from GMT in minutes var offset = date.getTimezoneOffset(); // set a cookie however you see fit, I like to use jQuery.cookie $.cookie('timezone', offset); Then, in application.rb or wherever you like:
def browser_timezone return nil if cookies[:timezone].blank? `browser_timezone ||= begin min = cookies[:timezone].to_i TimeZone[(min + (-2 * min)).minutes] end end The cookie gives you minutes from GMT, but `ActiveSupport::TimeZone@ expects seconds from GMT."><meta property="og:url" content="/posts/2009-01-17-using-cookies-to-calculate-a-users-timezone/"><meta property="og:site_name" content="Jason Madigan"><meta property="og:title" content="Using cookies to calculate a user's timezone"><meta property="og:description" content="A few days ago I discovered a quick & easy way few to use cookies to help your Rails app get a user’s timezone, without prompting. It’s pretty easy to implement:
First up: set a cookie, any cookie:
var date = new Date(); // returns offset from GMT in minutes var offset = date.getTimezoneOffset(); // set a cookie however you see fit, I like to use jQuery.cookie $.cookie('timezone', offset); Then, in application.rb or wherever you like:
def browser_timezone return nil if cookies[:timezone].blank? `browser_timezone ||= begin min = cookies[:timezone].to_i TimeZone[(min + (-2 * min)).minutes] end end The cookie gives you minutes from GMT, but `ActiveSupport::TimeZone@ expects seconds from GMT."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2009-01-17T21:00:00+00:00"><meta property="article:modified_time" content="2009-01-17T21:00:00+00:00"></head><body><header class=app-header><a href=/><img class=app-header-avatar src=/0.jpg alt="Jason Madigan"></a>
<span class=app-header-title>Jason Madigan</span><nav class=app-header-menu><a class=app-header-menu-item href=/about/>About</a></nav><p>He's just zis guy, ya know?</p><div class=app-header-social><a href=https://github.com/jasonmadigan target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
</a><a href=https://twitter.com/jasonmadigan target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Using cookies to calculate a user's timezone</h1><div class=post-meta><div><svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Jan 17, 2009</div><div><svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
1 min read</div></div></header><div class=post-content><p>A few days ago I <a href=http://github.com/entp/xtt/tree/master>discovered</a> a
quick & easy way few to use cookies to help your Rails app get a user&rsquo;s
timezone, without prompting. It&rsquo;s pretty easy to implement:</p><p>First up: set a cookie, any cookie:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date();
</span></span><span style=display:flex><span><span style=color:#75715e>// returns offset from GMT in minutes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>date</span>.<span style=color:#a6e22e>getTimezoneOffset</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// set a cookie however you see fit, I like to use jQuery.cookie
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>cookie</span>(<span style=color:#e6db74>&#39;timezone&#39;</span>, <span style=color:#a6e22e>offset</span>);
</span></span></code></pre></div><p>Then, in application.rb or wherever you like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>browser_timezone</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span> <span style=color:#66d9ef>if</span> cookies<span style=color:#f92672>[</span><span style=color:#e6db74>:timezone</span><span style=color:#f92672>].</span>blank?
</span></span><span style=display:flex><span> <span style=color:#e6db74>`browser_timezone ||= begin
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    min = cookies[:timezone].to_i
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    TimeZone[(min + (-2 * min)).minutes]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>end
</span></span></span></code></pre></div><p>The cookie gives you minutes from GMT, but `ActiveSupport::TimeZone@
expects seconds from GMT.</p><p>Anyway, hopefully someone will find my pointing it out useful. It may
buckle under pressure (with daylight savings), but guessing and getting
it right 50% of the time is better than forcing user interaction.
Probably.</p></div><div class=post-footer></div></article></main></body></html>